# 地址映射，差错控制和多播

## 地址映射

将分组传递到主机或路由器需要两级地址：逻辑地址和物理地址。

需要将一个逻辑地址映射成为它对应的物理地址，反过来也一样。

可以通过静态或动态映射完成。

![image-20250101131733237](assets/image-20250101131733237.png)

![image-20250101131749544](assets/image-20250101131749544.png)

![image-20250101131759417](assets/image-20250101131759417.png)

![image-20250101131827539](assets/image-20250101131827539.png)

![image-20250101131830531](assets/image-20250101131830531.png)

![image-20250101131833626](assets/image-20250101131833626.png)

![image-20250101131858561](assets/image-20250101131858561.png)

![image-20250101131912081](assets/image-20250101131912081.png)

![image-20250101131916269](assets/image-20250101131916269.png)

## ARP操作（地址解析协议）

ARP：IP地址到硬件地址的映射

![image-20250101131929081](assets/image-20250101131929081.png)

![image-20250101131932554](assets/image-20250101131932554.png)

如果ARP高速缓存中没有存目标主机的mac映射，就在局域网内广播发送ARP请求分组，同时在请求中附上自己的IP与硬件映射。接收到ARP请求分组的目标主机返回一个ARP响应分组。

![image-20250101132100715](assets/image-20250101132100715.png)

![image-20250101132302846](assets/image-20250101132302846.png)

需要注意的是ARP请求是在局域网范围内的。

![image-20250101132307892](assets/image-20250101132307892.png)

![image-20250101132421880](assets/image-20250101132421880.png)

![image-20250101132541689](assets/image-20250101132541689.png)

## RARP逆地址解析协议

逆地址解析协议RARP使只知道自己硬件地址的主机能够知道其IP地址。

这种主机往往是无盘工作站。因此RARP协议目前已很少使用

## ARP分组报文格式

![image-20250101132800767](assets/image-20250101132800767.png)

![image-20250101132803935](assets/image-20250101132803935.png)

![image-20250101132807736](assets/image-20250101132807736.png)

![image-20250101132815685](assets/image-20250101132815685.png)

eg：

![image-20250101133832045](assets/image-20250101133832045.png)

![image-20250101133859390](assets/image-20250101133859390.png)

#### 代理ARP

![image-20250101133951197](assets/image-20250101133951197.png)

#### RARP与BOOTP

![image-20250101134022785](assets/image-20250101134022785.png)

![image-20250101134124833](assets/image-20250101134124833.png)

![image-20250101134158286](assets/image-20250101134158286.png)

## DHCP

![image-20250101134208678](assets/image-20250101134208678.png)

DHCP提供可以是人工的或自动的静态或动态的地址配置。

首先静态查找，其次动态分配。

DHCP在有限的期间内提供临时IP地址。

租用期到时，停止使用该IP或更新其租用。

## ICMP

**因特网控制报文协议（ICMP）就是为了弥补IP协议没有差错报告或差错纠正机制，也缺少一种为主机或管理查询的机制这两个缺点设计的，它是配合IP协议使用的。**

![image-20250101134552254](assets/image-20250101134552254.png)

![image-20250101134608493](assets/image-20250101134608493.png)

### ICMP报文的格式

![image-20250101134730743](assets/image-20250101134730743.png)

![image-20250101135203995](assets/image-20250101135203995.png)

![image-20250101134746528](assets/image-20250101134746528.png)

注意：ICMP总是向原始的源方报告差错报文。

![image-20250101134811244](assets/image-20250101134811244.png)

![image-20250101134841754](assets/image-20250101134841754.png)

![image-20250101134846991](assets/image-20250101134846991.png)

![image-20250101134849341](assets/image-20250101134849341.png)

注意，以下几种情况不会产生ICMP差错报文：

![image-20250101134853620](assets/image-20250101134853620.png)

![image-20250101135413656](assets/image-20250101135413656.png)

![image-20250101135437310](assets/image-20250101135437310.png)

![image-20250101135447192](assets/image-20250101135447192.png)

![image-20250101135454145](assets/image-20250101135454145.png)

![image-20250101135511363](assets/image-20250101135511363.png)

## Ping命令【应用层直接使用网络层ICMP的例子】

![image-20250101135523002](assets/image-20250101135523002.png)

![image-20250101135637274](assets/image-20250101135637274.png)

![image-20250101135811208](assets/image-20250101135811208.png)

![image-20250101135814547](assets/image-20250101135814547.png)

![image-20250101135829275](assets/image-20250101135829275.png)

![image-20250101135834138](assets/image-20250101135834138.png)

## IGMP

IP协议可用到两种类型的通信∶单播和多播。

因特网组管理协议(Internet Group ManagementProtocol，IGMP)是其中一个必要的﹐但不是充分的协议（正如我们将会看到)，多播也包含其他的协议。在IP协议中，IGMP是一个辅助协议。

![image-20250101140202384](assets/image-20250101140202384.png)

![image-20250101140233991](assets/image-20250101140233991.png)

![image-20250101140241072](assets/image-20250101140241072.png)

![image-20250101140248497](assets/image-20250101140248497.png)

![image-20250101140306546](assets/image-20250101140306546.png)

![image-20250101140326995](assets/image-20250101140326995.png)

### IGMP报文格式

![image-20250101140331099](assets/image-20250101140331099.png)

![image-20250101140349666](assets/image-20250101140349666.png)

![image-20250101140402881](assets/image-20250101140402881.png)

![image-20250101140436909](assets/image-20250101140436909.png)

![image-20250101140540662](assets/image-20250101140540662.png)

![image-20250101140549152](assets/image-20250101140549152.png)

![image-20250101140559441](assets/image-20250101140559441.png)

![image-20250101140601597](assets/image-20250101140601597.png)

### IGMP分组

![image-20250101140726180](assets/image-20250101140726180.png)

![image-20250101140752086](assets/image-20250101140752086.png)

![image-20250101140819647](assets/image-20250101140819647.png)

![image-20250101140841038](assets/image-20250101140841038.png)

![image-20250101141101143](assets/image-20250101141101143.png)

![image-20250101141118485](assets/image-20250101141118485.png)

eg：

![image-20250101141154500](assets/image-20250101141154500.png)

![image-20250101141209479](assets/image-20250101141209479.png)

![image-20250101141223772](assets/image-20250101141223772.png)

### 隧道技术

![image-20250101141232695](assets/image-20250101141232695.png)

![image-20250101141254892](assets/image-20250101141254892.png)

![image-20250101141306956](assets/image-20250101141306956.png)

![image-20250101141309823](assets/image-20250101141309823.png)

## ICMPv6

![image-20250101141402373](assets/image-20250101141402373.png)

![image-20250101141413068](assets/image-20250101141413068.png)

![image-20250101141423041](assets/image-20250101141423041.png)