# 进程到进程的传递：UDP，TCP和SCTP

## 进程到进程的传递（端到端的通信）

传输层负责进程到进程的传递，即进程之间的分组传递以及部分消息传递。后面将会看到两个进程以客户/服务器的方式通信。

![image-20250103112346596](assets/image-20250103112346596.png)

![image-20250103112359809](assets/image-20250103112359809.png)

![image-20250103112857045](assets/image-20250103112857045.png)

![image-20250103112928189](assets/image-20250103112928189.png)

### TCP与UDP

![image-20250103113001526](assets/image-20250103113001526.png)

![image-20250103113019038](assets/image-20250103113019038.png)

![image-20250103113030501](assets/image-20250103113030501.png)

点到点、主机到主机、端到端（进程到进程）

![image-20250103113438894](assets/image-20250103113438894.png)

IP地址用于标定一个主机，端口用于标定该特定主机上的一个进程

![image-20250103113530758](assets/image-20250103113530758.png)

![image-20250103113551559](assets/image-20250103113551559.png)

![image-20250103113630310](assets/image-20250103113630310.png)

![image-20250103113646643](assets/image-20250103113646643.png)

![image-20250103113659435](assets/image-20250103113659435.png)

![image-20250103113804298](assets/image-20250103113804298.png)

![image-20250103113839932](assets/image-20250103113839932.png)

## 用户数据报协议（UDP）

用户数据报协议（UDP）称为无连接不可靠的传输层协议。他除了提供进程到进程通信而不是主机到主机的通信外，就没有给IP服务增加任何东西。

![image-20250103113957101](assets/image-20250103113957101.png)

![image-20250103114003580](assets/image-20250103114003580.png)

![image-20250103114146869](assets/image-20250103114146869.png)

### UDP用户数据报格式

![image-20250103114202176](assets/image-20250103114202176.png)

![image-20250103114231259](assets/image-20250103114231259.png)

![image-20250103114239158](assets/image-20250103114239158.png)

![image-20250103114329066](assets/image-20250103114329066.png)

![image-20250103114350825](assets/image-20250103114350825.png)

![image-20250103114355676](assets/image-20250103114355676.png)

![image-20250103114400138](assets/image-20250103114400138.png)

## TCP

TCP是一个面向连接的协议；它在两个TCP之间建立一个虚拟连接来发送数据。另外，TCP在传输层使用流量控制和差错控制机制。

![image-20250103114540802](assets/image-20250103114540802.png)

![image-20250103114559146](assets/image-20250103114559146.png)

![image-20250103114701456](assets/image-20250103114701456.png)

![image-20250103114705481](assets/image-20250103114705481.png)

![image-20250103114713841](assets/image-20250103114713841.png)

注意：

每个字节会得到一个编号。

![image-20250103114728554](assets/image-20250103114728554.png)

eg:

![image-20250103114903210](assets/image-20250103114903210.png)

通过第一个字节的序号和该段的长度字段就能计算出该段发送的数据序列号范围。

![image-20250103114944823](assets/image-20250103114944823.png)

![image-20250103114951562](assets/image-20250103114951562.png)

### TCP段报文格式

![image-20250103115043457](assets/image-20250103115043457.png)

![image-20250103115154831](assets/image-20250103115154831.png)

客户服务器方式：TCP的连接和建立都是采用客户服务器方式，主动发起连接建立的应用进程叫做客户（client），被动等待连接建立的应用进程叫做服务器（server）。

![image-20250103115439737](assets/image-20250103115439737.png)

### 三次握手建立连接

最开始双方商定初始序号的时候，将控制位的同步比特SYN置1，并选择序号x，表明传送数据的第一个数据字节的序号是x。接收的那一方如果通用，则发回确认号ACK为x+1的回复。

在三次握手之后，A和B再通知上层应用进程，连接已经建立

![image-20250103115510950](assets/image-20250103115510950.png)

![image-20250103115638530](assets/image-20250103115638530.png)

![image-20250103120412878](assets/image-20250103120412878.png)

![image-20250103120509502](assets/image-20250103120509502.png)

![image-20250103120521332](assets/image-20250103120521332.png)

![image-20250103120528820](assets/image-20250103120528820.png)

### 三次握手释放连接

![image-20250103120341773](assets/image-20250103120341773.png)

![image-20250103120204506](assets/image-20250103120204506.png)

![image-20250103121341662](assets/image-20250103121341662.png)

![image-20250103121518605](assets/image-20250103121518605.png)

![image-20250103121526924](assets/image-20250103121526924.png)

![image-20250103121534363](assets/image-20250103121534363.png)

### 数据传输

![image-20250103120938166](assets/image-20250103120938166.png)

### TCP的正常的连接建立和关闭

![image-20250103121716908](assets/image-20250103121716908.png)

## TCP流量控制-滑动窗口

滑动窗口大小设置为：Window size = minimum (rwnd, cwnd)

![image-20250103121800828](assets/image-20250103121800828.png)

![image-20250103121839186](assets/image-20250103121839186.png)

![image-20250103121930628](assets/image-20250103121930628.png)

![image-20250103121944757](assets/image-20250103121944757.png)

![image-20250103121950068](assets/image-20250103121950068.png)

![image-20250103122001147](assets/image-20250103122001147.png)

### TCP的流量控制与拥塞控制

滑动窗口的大小取接收端窗口rwnd和拥塞窗口cwnd的小的那个

![image-20250103122208795](assets/image-20250103122208795.png)

![image-20250103122318147](assets/image-20250103122318147.png)

![image-20250103122328629](assets/image-20250103122328629.png)

### 慢开始

![image-20250103122335378](assets/image-20250103122335378.png)

慢开始门限

![image-20250103122354195](assets/image-20250103122354195.png)

![image-20250103122624218](assets/image-20250103122624218.png)

![image-20250103122646398](assets/image-20250103122646398.png)

![image-20250103122648979](assets/image-20250103122648979.png)

![image-20250103122651828](assets/image-20250103122651828.png)

![image-20250103122657903](assets/image-20250103122657903.png)

![image-20250103122700850](assets/image-20250103122700850.png)

![image-20250103122704555](assets/image-20250103122704555.png)

![image-20250103122707884](assets/image-20250103122707884.png)

![image-20250103122712459](assets/image-20250103122712459.png)

![image-20250103122715448](assets/image-20250103122715448.png)

![image-20250103122726031](assets/image-20250103122726031.png)

![image-20250103122732006](assets/image-20250103122732006.png)

### 快重传和快回复

![image-20250103122735002](assets/image-20250103122735002.png)

![image-20250103122840546](assets/image-20250103122840546.png)

![image-20250103122843753](assets/image-20250103122843753.png)

![image-20250103122904076](assets/image-20250103122904076.png)

### TCP的重传机制

![image-20250103122912618](assets/image-20250103122912618.png)

![image-20250103122920593](assets/image-20250103122920593.png)

![image-20250103122927355](assets/image-20250103122927355.png)

![image-20250103131127778](assets/image-20250103131127778.png)

![image-20250103131142667](assets/image-20250103131142667.png)

![image-20250103131201588](assets/image-20250103131201588.png)

![image-20250103131217308](assets/image-20250103131217308.png)

![image-20250103131240073](assets/image-20250103131240073.png)

![image-20250103131321284](assets/image-20250103131321284.png)

+

![image-20250103131452856](assets/image-20250103131452856.png)

![image-20250103131526107](assets/image-20250103131526107.png)

![image-20250103131516814](assets/image-20250103131516814.png)

![image-20250103131536000](assets/image-20250103131536000.png)

![image-20250103131542481](assets/image-20250103131542481.png)

![image-20250103131559026](assets/image-20250103131559026.png)

![image-20250103131748438](assets/image-20250103131748438.png)

![image-20250103131740210](assets/image-20250103131740210.png)

![image-20250103131752265](assets/image-20250103131752265.png)

## SCTP（选讲）

流控传输协议(SCTP)是一种新的可靠的、面向报文的传输层协议。然而，SCTP主要是为最近引入的因特网应用而设计的。这些新应用所需要的服务都比TCP能提供的更复杂。































